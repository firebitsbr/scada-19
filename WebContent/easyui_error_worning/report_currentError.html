<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    
    <title></title>
    
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
	<!-- easyUI -->
	<link href="../jquery-easyui-1.4.4/themes/bootstrap/easyui.css" rel="stylesheet">
	<link href="../jquery-easyui-1.4.4/themes/icon.css" rel="stylesheet">
	
	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) --> 
	<script src="../jquery-easyui-1.4.4/jquery.min.js" charset="utf-8"></script>
	
	<!-- easyUI -->
	<script src="../jquery-easyui-1.4.4/jquery.easyui.min.js" charset="utf-8"></script>
	<script src="../jquery-easyui-1.4.4/locale/easyui-lang-zh_CN.js" charset="utf-8"></script>
	
	<style type="text/css">
		* {margin: 0; padding: 0;}
	</style>

	<script type="text/javascript">
		$(function(){
			$('#datagrid').datagrid({
				toolbar:'#toolBar',
				url:'',
				idField:'id',
				fit:true,
				striped:true,
				fitColumns:true,
				singleSelect:true,
				rownumbers: true,
				columns : [ [ {
					field : 'id',
					title : 'ID',
					width : 50,
					align : 'center',
					hidden: true
				}, {
					field : 'fun.name',
					title : '风机名称',
					width : 150,
					align : 'center'
				},{
					field : 'funTroubleVariable.code',
					title : '代码',
					width : 100,
					align : 'center'
				},{
					field : 'startTime',
					title : '发生时间',
					width : 120,
					align : 'center'
				},{
					field : 'endTime',
					title : '结束时间',
					width : 120,
					align : 'center'
				},{
					field : 'funTroubleVariable.description',
					title : '描述',
					width : 200,
					align : 'center'
				}
				]]
			});
			
			$('#funSelect').combobox({
				onChange:function(){
					$('#datagrid').datagrid('loadData',{ total:0, rows:[] });
				}
			})
			
			$('#searchSubmit').click(
				function(){
					$('#datagrid').datagrid('loadData',{ total:0, rows:[] });
					$.messager.progress();	// 显示进度条
					$('#from1').form('submit', {
						url:'SHARPOWER_SCADA/ajaxGetCurrentError',
						onSubmit: function(){
							var isValid = $(this).form('validate');
							if (!isValid){
								$.messager.progress('close');	// 如果表单是无效的则隐藏进度条
							}
							return isValid;	// 返回false终止表单提交
						},
						success: function(info){
							$.messager.progress('close');	// 如果提交成功则隐藏进度条
							info = eval("("+info+")");
							
							for(var o in info){
								$('#datagrid').datagrid('appendRow',
									{'id' : info[o].id,
									'fun.name':info[o].fun.name,
									'funTroubleVariable.code':info[o].funTroubleVariable.code,
									'startTime':info[o].startTime,
									'endTime':info[o].endTime,
									'funTroubleVariable.description':info[o].funTroubleVariable.description
									}
								);
								
							}
						}
					});
				}
			)
			
		})
		
	</script>

  </head>
  
  <body>

		<table id ="datagrid" >  
		</table>
		
		<div id="toolBar" style="height:25px,overflow:hidden" >
				<form id="from1" method="post">   
					选择风机：<select id="funSelect" name="funId" class="easyui-combobox" style="width:200px;" 
							url="SHARPOWER_SCADA/ajaxAllfun"  required="true" missingMessage="风机必选!" 
							valueField="id" textField="name">
							</select>
							<a id="searchSubmit" class="easyui-linkbutton">查询</a>
				</form>
		</div>	
  </body>

</html>